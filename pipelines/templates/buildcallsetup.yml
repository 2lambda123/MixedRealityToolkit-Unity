# [Template] Build binaries for Build Call in Unity.
parameters:
  UnityVersion: ""
  Binaries: "" # Brings the binaries parameter from pipelines/buildcallmanual.yml
#
# Build for the 'common' parameter.
# Each step is an example scene that builds a binary for each device.

# This step builds the HandInteractionExamples scene and publishes the project files.
steps:
- ${{ if contains(parameters.Binaries, 'all,common') }}:
# Build UWP ARM64.
  - template: tasks/bcunitybuild.yml
    parameters:
      Arch: 'arm64'
      Platform: 'UWP'
      PackagingDir: 'ARM64'
      UnityVersion: ${{ parameters.UnityVersion }}
      PublishArtifacts: true
      Scene: 'HandInteractionExamples'
      PublishProject: 'yes'
    
# Build UWP x86.
  - template: tasks/bcunitybuild.yml
    parameters:
      Arch: 'x86'
      Platform: 'UWP'
      PackagingDir: 'x86'
      UnityVersion: ${{ parameters.UnityVersion }}
      PublishArtifacts: true
      Scene: 'HandInteractionExamples'
      PublishProject: 'no'

# Build standalone x86.
  - template: tasks/bcunitybuild.yml
    parameters:
      Arch: 'x86'
      Platform: 'Standalone'
      PackagingDir: 'x86'
      UnityVersion: ${{ parameters.UnityVersion }}
      PublishArtifacts: true
      Scene: 'HandInteractionExamples'
      PublishProject: 'yes'    

  - template: tests.yml
    parameters:
      UnityVersion: ${{ parameters.UnityVersion }}

  - template: end.yml



# This step builds the EXSolvers scene.
steps:
- ${{ if contains(parameters.Binaries, 'all') }}:
# Build UWP ARM64.
  - template: tasks/bcunitybuild.yml
    parameters:
      Arch: 'arm64'
      Platform: 'UWP'
      PackagingDir: 'ARM64'
      UnityVersion: ${{ parameters.UnityVersion }}
      PublishArtifacts: true
      Scene: 'EXSolvers'
      PublishProject: 'no'
    
# Build UWP x86.
  - template: tasks/bcunitybuild.yml
    parameters:
      Arch: 'x86'
      Platform: 'UWP'
      PackagingDir: 'x86'
      UnityVersion: ${{ parameters.UnityVersion }}
      PublishArtifacts: true
      Scene: 'EXSolvers'
      PublishProject: 'no'

# Build standalone x86.
  - template: tasks/bcunitybuild.yml
    parameters:
      Arch: 'x86'
      Platform: 'Standalone'
      PackagingDir: 'x86'
      UnityVersion: ${{ parameters.UnityVersion }}
      PublishArtifacts: true
      Scene: 'EXSolvers'
      PublishProject: 'no'    

  - template: tests.yml
    parameters:
      UnityVersion: ${{ parameters.UnityVersion }}

  - template: end.yml