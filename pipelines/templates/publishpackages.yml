# [Template] Publish packages to artifacts and to NuGet feed

steps:
- task: PublishBuildArtifacts@1
  displayName: 'Publish Packages'
  inputs:
    PathtoPublish: '$(Build.SourcesDirectory)\artifacts'
    ArtifactName: 'mrtk-unity-packages'

- task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2  # NuGetCommand
  displayName: 'NuGet push'
  inputs:
    command: push
    packagesToPush: '$(Build.SourcesDirectory)/artifacts/**/*.nupkg;!$(Build.SourcesDirectory)/artifacts/**/*.symbols.nupkg'
    publishVstsFeed: '$(NuGetFeedId)'
    buildProperties: 'version=$(MRTKVersion)-$(Build.BuildNumber)'

- task: PowerShell@2
  displayName: 'Publish UPM packages to server'
  env:
    TESTREGISTRY $(TestRegistry)
  inputs:
    targetType: filePath
    filePath: ./scripts/packaging/publishupmpackages.ps1
    arguments: >
      -ProjectRoot $(Get-Location)
      -OutputDirectory $(Build.ArtifactStagingDirectory)\build\upm\output
      -IsPublicRelease 0
